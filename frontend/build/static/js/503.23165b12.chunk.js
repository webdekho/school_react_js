"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[503],{9503:(e,a,s)=>{s.r(a),s.d(a,{default:()=>w});var t=s(5043),l=s(1719),n=s(4063),i=s(4282),r=s(8628),c=s(8602),d=s(3722),o=s(3083),h=s(1072),x=s(7417),j=s(4196),m=s(6931),u=s(3248),b=s(7097),f=s(3768),p=s(7294),A=s(579);const v=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(e||0),w=()=>{var e,a;const[s,w]=(0,t.useState)(!1),[y,g]=(0,t.useState)(!1),[N,_]=(0,t.useState)(null),[C,S]=(0,t.useState)({amount:"",description:"",payment_method:"cash"}),[B,k]=(0,t.useState)(""),L=(0,u.jE)(),{data:F,isLoading:T,error:q}=(0,m.I)({queryKey:["staff_wallets",B],queryFn:async()=>{const e=new URLSearchParams;B&&e.append("search",B);return(await p.K.get(`/api/admin/staff-wallets?${e.toString()}`)).data}}),{data:K,isLoading:W}=(0,m.I)({queryKey:["wallet_statistics"],queryFn:async()=>(await p.K.get("/api/admin/wallet-statistics")).data}),{data:D,isLoading:I}=(0,m.I)({queryKey:["staff_ledger",null===N||void 0===N?void 0:N.staff_id],queryFn:async()=>{if(!N)return null;return(await p.K.get(`/api/admin/staff-wallet-ledger/${N.staff_id}`)).data},enabled:!!N}),$=(0,b.n)({mutationFn:async e=>await p.K.post(`/api/admin/process-withdrawal/${N.staff_id}`,e),onSuccess:()=>{L.invalidateQueries(["staff_wallets"]),L.invalidateQueries(["wallet_statistics"]),f.Ay.success("Withdrawal processed successfully!"),w(!1),S({amount:"",description:"",payment_method:"cash"})},onError:e=>{var a,s;f.Ay.error((null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to process withdrawal")}}),z=(0,b.n)({mutationFn:async e=>await p.K.post(`/api/admin/clear-wallet-balance/${e}`),onSuccess:()=>{L.invalidateQueries(["staff_wallets"]),L.invalidateQueries(["wallet_statistics"]),f.Ay.success("Balance cleared successfully!")},onError:e=>{var a,s;f.Ay.error((null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to clear balance")}}),H=(0,t.useCallback)(e=>{_(e),w(!0)},[]),P=(0,t.useCallback)(e=>{_(e),g(!0)},[]),E=(0,t.useCallback)(e=>{window.confirm(`Are you sure you want to clear the entire balance of \u20b9${e.current_balance} for ${e.staff_name}?`)&&z.mutate(e.staff_id)},[z]);if(q)return(0,A.jsxs)(l.A,{variant:"danger",children:["Error loading wallet data: ",q.message]});const G=(null===F||void 0===F?void 0:F.data)||[],Q=(null===K||void 0===K?void 0:K.data)||{};return(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:(0,A.jsx)("h2",{className:"mb-0",children:"Staff Wallet Management"})}),!W&&Q.totals&&(0,A.jsxs)(h.A,{className:"mb-4",children:[(0,A.jsx)(c.A,{md:3,children:(0,A.jsx)(r.A,{className:"h-100",children:(0,A.jsxs)(r.A.Body,{className:"text-center",children:[(0,A.jsx)("i",{className:"bi bi-wallet2 text-primary fs-1 mb-2"}),(0,A.jsx)("h4",{children:v(Q.totals.total_balance||0)}),(0,A.jsx)("p",{className:"text-muted mb-0",children:"Total Balance"})]})})}),(0,A.jsx)(c.A,{md:3,children:(0,A.jsx)(r.A,{className:"h-100",children:(0,A.jsxs)(r.A.Body,{className:"text-center",children:[(0,A.jsx)("i",{className:"bi bi-arrow-down-circle text-success fs-1 mb-2"}),(0,A.jsx)("h4",{children:v(Q.totals.total_collected||0)}),(0,A.jsx)("p",{className:"text-muted mb-0",children:"Total Collected"})]})})}),(0,A.jsx)(c.A,{md:3,children:(0,A.jsx)(r.A,{className:"h-100",children:(0,A.jsxs)(r.A.Body,{className:"text-center",children:[(0,A.jsx)("i",{className:"bi bi-arrow-up-circle text-warning fs-1 mb-2"}),(0,A.jsx)("h4",{children:v(Q.totals.total_withdrawn||0)}),(0,A.jsx)("p",{className:"text-muted mb-0",children:"Total Withdrawn"})]})})}),(0,A.jsx)(c.A,{md:3,children:(0,A.jsx)(r.A,{className:"h-100",children:(0,A.jsxs)(r.A.Body,{className:"text-center",children:[(0,A.jsx)("i",{className:"bi bi-people text-info fs-1 mb-2"}),(0,A.jsx)("h4",{children:Q.totals.total_wallets||0}),(0,A.jsx)("p",{className:"text-muted mb-0",children:"Active Wallets"})]})})})]}),(0,A.jsx)(r.A,{className:"mb-4",children:(0,A.jsx)(r.A.Body,{children:(0,A.jsx)(h.A,{children:(0,A.jsx)(c.A,{md:6,children:(0,A.jsxs)(d.A.Group,{children:[(0,A.jsx)(d.A.Label,{children:"Search Staff"}),(0,A.jsx)(d.A.Control,{type:"text",placeholder:"Search by name, mobile, or email...",value:B,onChange:e=>k(e.target.value)})]})})})})}),(0,A.jsxs)(r.A,{children:[(0,A.jsx)(r.A.Header,{children:(0,A.jsx)("h5",{className:"mb-0",children:"Staff Wallets"})}),(0,A.jsx)(r.A.Body,{children:T?(0,A.jsx)("div",{className:"text-center py-4",children:(0,A.jsx)(x.A,{animation:"border"})}):(0,A.jsx)("div",{className:"table-responsive",children:(0,A.jsxs)(j.A,{striped:!0,hover:!0,children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{children:"Staff Name"}),(0,A.jsx)("th",{children:"Contact"}),(0,A.jsx)("th",{children:"Current Balance"}),(0,A.jsx)("th",{children:"Total Collected"}),(0,A.jsx)("th",{children:"Total Withdrawn"}),(0,A.jsx)("th",{children:"Last Transaction"}),(0,A.jsx)("th",{children:"Actions"})]})}),(0,A.jsx)("tbody",{children:0===G.length?(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:"7",className:"text-center",children:"No wallet data found"})}):G.map(e=>(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("div",{children:(0,A.jsx)("strong",{children:e.staff_name})})}),(0,A.jsx)("td",{children:(0,A.jsxs)("div",{children:[(0,A.jsx)("small",{className:"text-muted",children:e.mobile}),(0,A.jsx)("br",{}),(0,A.jsx)("small",{className:"text-muted",children:e.email})]})}),(0,A.jsx)("td",{children:(0,A.jsx)(n.A,{bg:e.current_balance>0?"success":"secondary",className:"fs-6",children:v(e.current_balance)})}),(0,A.jsx)("td",{children:v(e.total_collected)}),(0,A.jsx)("td",{children:v(e.total_withdrawn)}),(0,A.jsx)("td",{children:(0,A.jsx)("small",{className:"text-muted",children:e.last_transaction_at?new Date(e.last_transaction_at).toLocaleString():"No transactions"})}),(0,A.jsx)("td",{children:(0,A.jsxs)("div",{className:"d-flex gap-2",children:[(0,A.jsx)(i.A,{size:"sm",variant:"outline-primary",onClick:()=>P(e),children:(0,A.jsx)("i",{className:"bi bi-journal-text"})}),e.current_balance>0&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(i.A,{size:"sm",variant:"outline-warning",onClick:()=>H(e),children:(0,A.jsx)("i",{className:"bi bi-cash-stack"})}),(0,A.jsx)(i.A,{size:"sm",variant:"outline-danger",onClick:()=>E(e),disabled:z.isLoading,children:(0,A.jsx)("i",{className:"bi bi-x-circle"})})]})]})})]},e.staff_id))})]})})})]}),(0,A.jsxs)(o.A,{show:s,onHide:()=>w(!1),children:[(0,A.jsx)(o.A.Header,{closeButton:!0,children:(0,A.jsx)(o.A.Title,{children:"Process Withdrawal"})}),(0,A.jsxs)(d.A,{onSubmit:e=>{e.preventDefault(),$.mutate(C)},children:[(0,A.jsxs)(o.A.Body,{children:[N&&(0,A.jsxs)("div",{className:"mb-3",children:[(0,A.jsx)("strong",{children:"Staff:"})," ",N.staff_name,(0,A.jsx)("br",{}),(0,A.jsx)("strong",{children:"Available Balance:"})," ",v(N.current_balance)]}),(0,A.jsxs)(d.A.Group,{className:"mb-3",children:[(0,A.jsx)(d.A.Label,{children:"Amount *"}),(0,A.jsx)(d.A.Control,{type:"number",step:"0.01",max:null===N||void 0===N?void 0:N.current_balance,value:C.amount,onChange:e=>S({...C,amount:e.target.value}),required:!0})]}),(0,A.jsxs)(d.A.Group,{className:"mb-3",children:[(0,A.jsx)(d.A.Label,{children:"Payment Method"}),(0,A.jsxs)(d.A.Select,{value:C.payment_method,onChange:e=>S({...C,payment_method:e.target.value}),children:[(0,A.jsx)("option",{value:"cash",children:"Cash"}),(0,A.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"}),(0,A.jsx)("option",{value:"cheque",children:"Cheque"})]})]}),(0,A.jsxs)(d.A.Group,{className:"mb-3",children:[(0,A.jsx)(d.A.Label,{children:"Description"}),(0,A.jsx)(d.A.Control,{as:"textarea",rows:3,value:C.description,onChange:e=>S({...C,description:e.target.value}),placeholder:"Optional description for this withdrawal..."})]})]}),(0,A.jsxs)(o.A.Footer,{children:[(0,A.jsx)(i.A,{variant:"secondary",onClick:()=>w(!1),children:"Cancel"}),(0,A.jsx)(i.A,{variant:"warning",type:"submit",disabled:$.isLoading,children:$.isLoading?"Processing...":"Process Withdrawal"})]})]})]}),(0,A.jsxs)(o.A,{show:y,onHide:()=>g(!1),size:"lg",children:[(0,A.jsx)(o.A.Header,{closeButton:!0,children:(0,A.jsxs)(o.A.Title,{children:["Staff Ledger - ",null===N||void 0===N?void 0:N.staff_name]})}),(0,A.jsx)(o.A.Body,{children:I?(0,A.jsx)("div",{className:"text-center",children:(0,A.jsx)(x.A,{animation:"border"})}):(0,A.jsx)("div",{className:"table-responsive",children:(0,A.jsxs)(j.A,{striped:!0,hover:!0,size:"sm",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{children:"Date"}),(0,A.jsx)("th",{children:"Type"}),(0,A.jsx)("th",{children:"Amount"}),(0,A.jsx)("th",{children:"Balance"}),(0,A.jsx)("th",{children:"Description"})]})}),(0,A.jsx)("tbody",{children:0===(null===D||void 0===D||null===(e=D.data)||void 0===e?void 0:e.length)?(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:"5",className:"text-center",children:"No transactions found"})}):null===D||void 0===D||null===(a=D.data)||void 0===a?void 0:a.map(e=>(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("small",{children:new Date(e.transaction_date).toLocaleDateString()})}),(0,A.jsx)("td",{children:(0,A.jsx)(n.A,{bg:"collection"===e.transaction_type?"success":"warning",children:e.transaction_type})}),(0,A.jsxs)("td",{className:e.amount>=0?"text-success":"text-danger",children:[e.amount>=0?"+":"",v(Math.abs(e.amount))]}),(0,A.jsx)("td",{children:v(e.balance)}),(0,A.jsx)("td",{children:(0,A.jsx)("small",{children:e.description})})]},e.id))})]})})}),(0,A.jsx)(o.A.Footer,{children:(0,A.jsx)(i.A,{variant:"secondary",onClick:()=>g(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=503.23165b12.chunk.js.map